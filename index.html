<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WASM Stuff</title>
  </head>
  <body>
    <div id="chartContainer" style="height: 300px; width: 100%"></div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script src="./js/loader.js"></script>
    <script>
      const WL = new WasmLoader();
      WL.wasm('/build/optimized.wasm').then((instance) => {
        const { fibAS } = instance;

        function fibJS(num) {
          let a = 0;
          let b = 1;

          for (let i = 0; i < num; i++) {
            b = a + b;
            a = b;
          }

          return b;
        }

        function test(num, type) {
          let prev = window.performance.now();
          if (type === 'js') {
            fibJS(num);
          } else {
            fibAS(num);
          }
          return window.performance.now() - prev;
        }

        const jsData = [];
        const asData = [];

        for (let i = 0; i < 1000000; i += 10) {
          jsData.push({
            x: i,
            y: test(i, 'js'),
          });

          asData.push({
            x: i,
            y: test(i),
          });
        }

        const chart = new CanvasJS.Chart('chartContainer', {
          title: {
            text: 'AS vs TS Fib Time',
          },
          toolTip: {
            shared: true,
          },
          legend: {
            cursor: 'pointer',
            verticalAlign: 'top',
            horizontalAlign: 'center',
            dockInsidePlotArea: true,
          },
          data: [
            {
              type: 'line',
              axisYType: 'secondary',
              name: 'AssemblyScript',
              showInLegend: true,
              markerSize: 0,
              dataPoints: asData,
            },
            {
              type: 'line',
              axisYType: 'secondary',
              name: 'JavaScript',
              showInLegend: true,
              markerSize: 0,
              dataPoints: jsData,
            },
          ],
        });

        chart.render();
      });
    </script>
  </body>
</html>
